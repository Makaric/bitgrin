language: rust

git:
  depth: false

dist: trusty
sudo: required

cache:
  cargo: true
  timeout: 240
  directories:
    - $HOME/.cargo
    - $TRAVIS_BUILD_DIR/target

before_cache:
  - rm -rf $TRAVIS_BUILD_DIR/target/tmp

rust:
  - stable

addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
    packages:
      - g++-5
      - cmake
      - libcurl4-openssl-dev
      - libelf-dev
      - libdw-dev
      - cmake
      - gcc
      - binutils-dev

env:
  global:
    - RUST_BACKTRACE="1"
    - RUST_FLAGS="-C debug-assertions"

matrix:
  include:
    - os: linux
      env: TEST_SUITE=servers
    - os: linux
      env: TEST_SUITE=chain-core
    - os: linux
      env: TEST_SUITE=pool-p2p-src
    - os: linux
      env: TEST_SUITE=keychain-wallet
    - os: linux
      env: TEST_SUITE=api-util-store
    - os: osx
      env: TEST_SUITE=release

script:
  - echo "skipping tests"

before_deploy:
  - if [[ "$TEST_SUITE" == "pool-p2p-src" ]]; then
      cargo clean && cargo build --release && ./.auto-release.sh;
    fi
  - if [[ "$TEST_SUITE" == "release" ]]  && [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
      brew update;
      cargo clean && cargo build --release && ./.auto-release.sh;
    fi

deploy:
  provider: releases
  api_key:
    secure: GfVG4j1U8OZMgZJBb7zPnVlVBth7vrHDIo5Uei80xYDfiel8P6/Had7H1Lhb6rfAKt/SgN3mUXRjSkVUiilpWv9hVAKOQrIAimSJrCVU2ooMd7rbsNCiQQYcA3P6WHqvFgt6g+Ye2/bH3mVDlj6mSIqVi5KeKJArxnIKnzM9lgIAWAM/2s3thZAfuG7jBvXDOAUSmBEdWUZOEvw2nxFJNdmyiGHBpGsakee/SnvsMwydI+L0LDTQXqCaxCqJ0KhZIak+zFQjYV2xlf07vANZ/l6fgIB4uFMKFgRzcI7GL0mFQzMrK8BZMypoFNopQt19qDEPLeB7rShpncELcjSAjSh+Ndu9CIFaVZINahw2/CermoQSlA9SvmIx6D1cO2AwhSqCa/6muLkqFZfmpWN9eRREVWtIHXpltleGYVSz7DrTTQuJLnDjhclGUlb3BFvSm7MNovTozZ6Y1O80TVmZt8WBjmeVBPZoLxmlyzPlWJHA4zxm8r6dU2PlbD+qHY8f6HWk8R3hbM50ESQDjzWEJa/l81xr3XTQHmZ1dWc2o3S5CGRiOjSwrlGTD7ajHMFWPoEgnx2MsAhdpM990zJzpuHWFEvxCWmheEADZgls3QFJQHmN8LShhQ3CE7JUqxdKjqmi2oTgTfL/YzLTH/onqVPgFMkUbCwj1hFzJzKSVvo=
  file_glob: true
  file: target/release/bitgrin-*.tgz*
  skip_cleanup: true
  on:
    repo: bitgrin/bitgrin
    tags: true
